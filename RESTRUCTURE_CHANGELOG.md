# sageLLM æ¶æ„é‡æ„è®°å½•

**æ—¥æœŸ**: 2025-12-23  
**åˆ†æ”¯**: `research/domestic-accelerator-inference-engine`  
**ç›®æ ‡**: å»ºç«‹è‡ªç ”æ¨ç†è¿è¡Œæ—¶æ¶æ„ï¼Œæ”¯æŒ PD åˆ†ç¦»å’Œå›½äº§åŠ é€Ÿå™¨

---

## é‡æ„æ¦‚è¿°

æœ¬æ¬¡é‡æ„å°† sageLLM ä»"åŒ…è£…ç¬¬ä¸‰æ–¹å¼•æ“"çš„æ¶æ„è½¬å˜ä¸º"è‡ªç ”æ ¸å¿ƒ + ç¡¬ä»¶åç«¯æŠ½è±¡ + å¯é€‰ç¬¬ä¸‰æ–¹å¼•æ“"çš„æ¶æ„ã€‚

### è®¾è®¡ç†å¿µ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         sageLLM Architecture                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    Control Plane (æ§åˆ¶å¹³é¢)                      â”‚   â”‚
â”‚  â”‚   â€¢ è¯·æ±‚è°ƒåº¦ (FIFO/Priority/SLO-Aware/Adaptive)                 â”‚   â”‚
â”‚  â”‚   â€¢ PD åˆ†ç¦»è·¯ç”±                                                  â”‚   â”‚
â”‚  â”‚   â€¢ å¤šå®ä¾‹ç®¡ç†                                                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                    â”‚                                    â”‚
â”‚                                    â–¼                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                     Runtime (è‡ªç ”è¿è¡Œæ—¶)                         â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚ execution_graph â”‚ â”‚      comm       â”‚ â”‚    scheduler    â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ IR å®šä¹‰       â”‚ â”‚  â€¢ é€šä¿¡åè®®     â”‚ â”‚  â€¢ PD è°ƒåº¦å™¨    â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ å›¾æ„å»º        â”‚ â”‚  â€¢ æ‹“æ‰‘å‘ç°     â”‚ â”‚  â€¢ æ‰¹å¤„ç†       â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ ä¼˜åŒ– Pass    â”‚ â”‚  â€¢ é›†åˆé€šä¿¡     â”‚ â”‚  â€¢ ä¼˜å…ˆçº§       â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                    â”‚                                    â”‚
â”‚                                    â–¼                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                   Backends (ç¡¬ä»¶åç«¯æŠ½è±¡)                        â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚   â”‚
â”‚  â”‚  â”‚   cuda   â”‚ â”‚  ascend  â”‚ â”‚cambricon â”‚ â”‚  hygon   â”‚          â”‚   â”‚
â”‚  â”‚  â”‚  NVIDIA  â”‚ â”‚   åä¸º   â”‚ â”‚  å¯’æ­¦çºª  â”‚ â”‚   æµ·å…‰   â”‚          â”‚   â”‚
â”‚  â”‚  â”‚   GPU    â”‚ â”‚   æ˜‡è…¾   â”‚ â”‚   MLU    â”‚ â”‚   DCU    â”‚          â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              Third-Party Engines (å¯é€‰ï¼Œç”¨äºå¯¹æ¯”å®éªŒ)            â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚   â”‚
â”‚  â”‚  â”‚ lmdeploy â”‚ â”‚   vllm   â”‚ â”‚ vllm_ascend  â”‚                    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## è¯¦ç»†æ”¹åŠ¨åˆ—è¡¨

### 1. åˆ é™¤çš„å†…å®¹

| åˆ é™¤é¡¹ | åŸè·¯å¾„ | åˆ é™¤åŸå›  |
|--------|--------|----------|
| LMDeploy submodule | `third_party/lmdeploy/` | ä¸å†ä¾èµ– vendored ä»£ç  |
| `.gitmodules` | `.gitmodules` | æ—  submodule éœ€è¦ |
| `scheduler_ir/` | `scheduler_ir/` | åŠŸèƒ½è¿ç§»åˆ° `runtime/execution_graph/` |
| `comm_backend/` | `comm_backend/` | åŠŸèƒ½è¿ç§»åˆ° `runtime/comm/` |

### 2. æ–°å¢çš„ç›®å½•å’Œæ–‡ä»¶

#### 2.1 `runtime/` - è‡ªç ”æ¨ç†è¿è¡Œæ—¶

```
runtime/
â”œâ”€â”€ __init__.py
â”œâ”€â”€ execution_graph/          # æ‰§è¡Œå›¾ IRï¼ˆæ›¿ä»£ scheduler_irï¼‰
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ ir.py                 # ExecutionGraph, Node, Edge å®šä¹‰
â”‚   â”œâ”€â”€ builder.py            # GraphBuilder, PrefillDecodeBuilder
â”‚   â””â”€â”€ optimizer.py          # ä¼˜åŒ– Passï¼ˆFusion, Memory, Schedulingï¼‰
â”œâ”€â”€ comm/                     # é€šä¿¡å±‚ï¼ˆæ›¿ä»£ comm_backendï¼‰
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ protocols.py          # é€šä¿¡åè®®ï¼ˆRDMA/TCP/SharedMemï¼‰
â”‚   â”œâ”€â”€ topology.py           # æ‹“æ‰‘å‘ç°ï¼ˆDevice, Connection, Nodeï¼‰
â”‚   â””â”€â”€ collective.py         # é›†åˆé€šä¿¡ï¼ˆAllReduce, AllGather ç­‰ï¼‰
â””â”€â”€ scheduler/                # è°ƒåº¦å™¨
    â”œâ”€â”€ __init__.py
    â”œâ”€â”€ base.py               # BaseScheduler, Request, Batch
    â””â”€â”€ pd_scheduler.py       # PDSchedulerï¼ˆPD åˆ†ç¦»è°ƒåº¦ï¼‰
```

#### 2.2 `backends/` - ç¡¬ä»¶åç«¯æŠ½è±¡

```
backends/
â”œâ”€â”€ __init__.py               # åç«¯æ³¨å†Œã€å·¥å‚å‡½æ•°
â”œâ”€â”€ base.py                   # HardwareBackend æŠ½è±¡åŸºç±»
â”œâ”€â”€ cuda/
â”‚   â””â”€â”€ __init__.py           # NVIDIA CUDA åç«¯
â”œâ”€â”€ ascend/
â”‚   â””â”€â”€ __init__.py           # åä¸ºæ˜‡è…¾ NPU åç«¯
â”œâ”€â”€ cambricon/
â”‚   â””â”€â”€ __init__.py           # å¯’æ­¦çºª MLU åç«¯
â””â”€â”€ hygon/
    â””â”€â”€ __init__.py           # æµ·å…‰ DCU åç«¯
```

#### 2.3 `third_party_engines/` - ç¬¬ä¸‰æ–¹å¼•æ“ï¼ˆåŸ `engines/`ï¼‰

```
third_party_engines/
â”œâ”€â”€ __init__.py               # å¼•æ“æ³¨å†Œã€å·¥å‚å‡½æ•°
â”œâ”€â”€ base.py                   # BaseEngine æŠ½è±¡åŸºç±»ï¼ˆä¿ç•™ï¼‰
â”œâ”€â”€ types.py                  # EngineConfig ç­‰ç±»å‹ï¼ˆä¿ç•™ï¼‰
â”œâ”€â”€ lmdeploy/                 # LMDeploy å¼•æ“ï¼ˆä¿ç•™ï¼‰
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ engine.py
â”‚   â”œâ”€â”€ kv_manager.py
â”‚   â””â”€â”€ scheduler.py
â”œâ”€â”€ vllm/                     # ğŸ†• vLLM å¼•æ“
â”‚   â””â”€â”€ __init__.py
â””â”€â”€ vllm_ascend/              # ğŸ†• vLLM-Ascendï¼ˆæ˜‡è…¾ï¼‰å¼•æ“
    â””â”€â”€ __init__.py
```

#### 2.4 `third_party/reference/` - å‚è€ƒèµ„æ–™

```
third_party/
â””â”€â”€ reference/
    â””â”€â”€ README.md             # å‚è€ƒä»£ç è¯´æ˜ï¼ˆéä»£ç ä¾èµ–ï¼‰
```

### 3. ä¿®æ”¹çš„æ–‡ä»¶

| æ–‡ä»¶ | ä¿®æ”¹å†…å®¹ |
|------|----------|
| `__init__.py` | æ›´æ–°æ¨¡å—å¯¼å‡ºï¼Œç§»é™¤ `scheduler_ir`/`comm_backend`/`engines`ï¼Œæ·»åŠ  `runtime`/`backends`/`third_party_engines` |
| `README.md` | é‡å†™ä¸ºæ–°æ¶æ„è¯´æ˜ï¼ŒåŒ…å«ç ”ç©¶è¯¾é¢˜ä»‹ç» |
| `third_party_engines/__init__.py` | æ·»åŠ å¼•æ“æ³¨å†Œæœºåˆ¶ï¼Œè‡ªåŠ¨å‘ç°å¯ç”¨å¼•æ“ |
| `third_party_engines/lmdeploy/__init__.py` | ä½¿ç”¨ `register_engine` è£…é¥°å™¨æ³¨å†Œ |

---

## æ–°æ¨¡å—è¯´æ˜

### `backends/` - ä¸ºä»€ä¹ˆè‡ªç ”è€Œä¸æŠ„ vLLMï¼Ÿ

| å¯¹æ¯”é¡¹ | vLLM | æˆ‘ä»¬çš„è®¾è®¡ |
|--------|------|------------|
| ç¡¬ä»¶ç»‘å®š | æ·±åº¦è€¦åˆ CUDA | ç¡¬ä»¶æ— å…³æŠ½è±¡ |
| å›½äº§æ”¯æŒ | vLLM-Ascend æ˜¯ forkï¼Œç»´æŠ¤å›°éš¾ | åŸç”Ÿå¤šåç«¯è®¾è®¡ |
| æ‰©å±•æ€§ | åŠ æ–°ç¡¬ä»¶éœ€å¤§é‡æ”¹åŠ¨ | å®ç° `HardwareBackend` å³å¯ |

```python
# backends/base.py å®šä¹‰çš„æŠ½è±¡æ¥å£
class HardwareBackend(ABC):
    def get_device_count(self) -> int: ...
    def allocate(self, size_bytes, memory_kind) -> MemoryHandle: ...
    def copy(self, src, dst, async_op=False) -> None: ...
    def launch_kernel(self, kernel, config, *args) -> None: ...
    # ... æ›´å¤šæŠ½è±¡æ–¹æ³•
```

### `runtime/` - è‡ªç ”è¿è¡Œæ—¶æ ¸å¿ƒ

| æ¨¡å— | åŠŸèƒ½ | å¯¹æ ‡ |
|------|------|------|
| `execution_graph/` | PD åˆ†ç¦»æ‰§è¡Œå›¾ IR | vLLM Scheduler + LMDeploy TurboMind |
| `comm/` | è·¨èŠ‚ç‚¹é€šä¿¡æŠ½è±¡ | NCCL/HCCL/CNCL ç»Ÿä¸€å°è£… |
| `scheduler/` | è¯·æ±‚è°ƒåº¦ã€æ‰¹å¤„ç† | vLLM Scheduler |

### `third_party_engines/` - ç¬¬ä¸‰æ–¹å¼•æ“ç”¨é€”

1. **å®éªŒå¯¹æ¯”**ï¼šä¸è‡ªç ” runtime åšæ€§èƒ½å¯¹æ¯”
2. **å¼€å‘è¿‡æ¸¡**ï¼šè‡ªç ”æœªå®Œæˆæ—¶çš„ä¸´æ—¶æ–¹æ¡ˆ
3. **å…¼å®¹æ€§**ï¼šæ”¯æŒç”¨æˆ·ç°æœ‰éƒ¨ç½²

```python
# ä½¿ç”¨ç¤ºä¾‹
from sageLLM import third_party_engines

# åˆ—å‡ºå¯ç”¨å¼•æ“
engines = third_party_engines.list_available_engines()
# ['lmdeploy', 'vllm', 'vllm_ascend']  # å–å†³äºå®‰è£…äº†å“ªäº›

# è·å–å¼•æ“å®ä¾‹
engine = third_party_engines.get_engine("vllm", model="Qwen/Qwen2.5-7B")
await engine.start()
result = await engine.generate("Hello")
```

---

## ç›®å½•ç»“æ„å¯¹æ¯”

### é‡æ„å‰

```
sageLLM/
â”œâ”€â”€ control_plane/       âœ… ä¿ç•™
â”œâ”€â”€ core/                âœ… ä¿ç•™
â”œâ”€â”€ scheduler_ir/        âŒ åˆ é™¤ â†’ runtime/execution_graph/
â”œâ”€â”€ comm_backend/        âŒ åˆ é™¤ â†’ runtime/comm/
â”œâ”€â”€ engines/             ğŸ”„ é‡å‘½å â†’ third_party_engines/
â”œâ”€â”€ kv_runtime/          âœ… ä¿ç•™
â”œâ”€â”€ kv_policy/           âœ… ä¿ç•™
â”œâ”€â”€ prefix_reuse/        âœ… ä¿ç•™
â”œâ”€â”€ accel/               âœ… ä¿ç•™
â”œâ”€â”€ third_party/
â”‚   â””â”€â”€ lmdeploy/        âŒ åˆ é™¤ (submodule)
â””â”€â”€ ...
```

### é‡æ„å

```
sageLLM/
â”œâ”€â”€ __init__.py              # æ›´æ–°
â”œâ”€â”€ README.md                # æ›´æ–°
â”œâ”€â”€ RESTRUCTURE_CHANGELOG.md # ğŸ†• æœ¬æ–‡ä»¶
â”‚
â”œâ”€â”€ control_plane/           # âœ… ä¿ç•™
â”œâ”€â”€ core/                    # âœ… ä¿ç•™
â”‚
â”œâ”€â”€ runtime/                 # ğŸ†• è‡ªç ”è¿è¡Œæ—¶
â”‚   â”œâ”€â”€ execution_graph/
â”‚   â”œâ”€â”€ comm/
â”‚   â””â”€â”€ scheduler/
â”‚
â”œâ”€â”€ backends/                # ğŸ†• ç¡¬ä»¶åç«¯
â”‚   â”œâ”€â”€ cuda/
â”‚   â”œâ”€â”€ ascend/
â”‚   â”œâ”€â”€ cambricon/
â”‚   â””â”€â”€ hygon/
â”‚
â”œâ”€â”€ third_party_engines/     # ğŸ”„ åŸ engines/
â”‚   â”œâ”€â”€ lmdeploy/
â”‚   â”œâ”€â”€ vllm/                # ğŸ†•
â”‚   â””â”€â”€ vllm_ascend/         # ğŸ†•
â”‚
â”œâ”€â”€ kv_runtime/              # âœ… ä¿ç•™
â”œâ”€â”€ kv_policy/               # âœ… ä¿ç•™
â”œâ”€â”€ prefix_reuse/            # âœ… ä¿ç•™
â”œâ”€â”€ accel/                   # âœ… ä¿ç•™
â”œâ”€â”€ benchmarks/              # âœ… ä¿ç•™
â”‚
â”œâ”€â”€ third_party/
â”‚   â””â”€â”€ reference/           # ğŸ†• å‚è€ƒèµ„æ–™
â”‚
â”œâ”€â”€ tests/                   # âœ… ä¿ç•™
â””â”€â”€ dev-notes/               # âœ… ä¿ç•™
```

---

## ç ”ç©¶è¯¾é¢˜æ˜ å°„

| ç ”ç©¶è¯¾é¢˜ | ç›¸å…³æ¨¡å— |
|----------|----------|
| **PD åˆ†ç¦»ä¼˜åŒ–** | `runtime/scheduler/pd_scheduler.py`, `runtime/execution_graph/` |
| **å›½äº§åŠ é€Ÿå™¨æ”¯æŒ** | `backends/{ascend,cambricon,hygon}/` |
| **KV Cache ä¼˜åŒ–** | `kv_runtime/`, `kv_policy/`, `prefix_reuse/` |
| **è°ƒåº¦ç®—æ³•** | `control_plane/strategies/`, `runtime/scheduler/` |

---

## åç»­å¼€å‘è®¡åˆ’

1. **Phase 1**: å®Œå–„ `backends/` æ¥å£å®šä¹‰ï¼ŒCUDA åç«¯å…ˆè¡Œ
2. **Phase 2**: å®ç° `runtime/` æ ¸å¿ƒè°ƒåº¦é€»è¾‘
3. **Phase 3**: æ˜‡è…¾åç«¯é€‚é…ï¼Œä½¿ç”¨ `third_party_engines/vllm_ascend` åšå¯¹æ¯”
4. **Phase 4**: å…¶ä»–å›½äº§åŠ é€Ÿå™¨æ”¯æŒ

---

## ä½¿ç”¨ç¤ºä¾‹

### ä½¿ç”¨è‡ªç ”è¿è¡Œæ—¶

```python
from sageLLM import backends, runtime
from sageLLM.runtime.scheduler import PDScheduler, PDSchedulerConfig

# è·å–ç¡¬ä»¶åç«¯
backend = backends.get_backend("cuda")
print(f"Found {backend.get_device_count()} devices")

# é…ç½® PD åˆ†ç¦»è°ƒåº¦
config = PDSchedulerConfig(
    prefill_device_ids=[0, 1],
    decode_device_ids=[2, 3, 4, 5],
)
scheduler = PDScheduler(config)

# æ·»åŠ è¯·æ±‚
from sageLLM.runtime.scheduler.base import Request
scheduler.add_request(Request(
    request_id="req_1",
    prompt_token_ids=[1, 2, 3, ...],
))

# è·å–æ‰§è¡Œæ‰¹æ¬¡
prefill_batch = scheduler.get_prefill_batch()
decode_batch = scheduler.get_decode_batch()
```

### ä½¿ç”¨ç¬¬ä¸‰æ–¹å¼•æ“åšå¯¹æ¯”

```python
from sageLLM import third_party_engines

# vLLM
engine = third_party_engines.get_engine("vllm", model="Qwen/Qwen2.5-7B")

# vLLM-Ascend (æ˜‡è…¾)
engine = third_party_engines.get_engine("vllm_ascend", model="Qwen/Qwen2.5-7B")

# LMDeploy
engine = third_party_engines.get_engine("lmdeploy", model="Qwen/Qwen2.5-7B")
```

---

## å‚è€ƒèµ„æ–™

- [vLLM](https://github.com/vllm-project/vllm) - PagedAttention å‚è€ƒ
- [vLLM-Ascend](https://github.com/vllm-project/vllm-ascend) - æ˜‡è…¾é€‚é…å‚è€ƒ
- [LMDeploy](https://github.com/InternLM/lmdeploy) - TurboMind å¼•æ“å‚è€ƒ
- [DistServe](https://arxiv.org/abs/2401.09670) - PD åˆ†ç¦»è®ºæ–‡
